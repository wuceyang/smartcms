<extend from="admin/base.html"/>

<define name="content"/>
    <!-- 当前位置 -->
    <div id="urHere">内容管理<b>»</b><strong>添加内容</strong> </div>
    <div class="mainBox">
        <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
            <tbody>
                <tr>
                    <th width="131"></th>
                    <th></th>
                </tr>
                <tr>
                    <td align="right">文章标题</td>
                    <td><input type="text" name="title" value="" size="80" class="inpMain"> *</td>
                </tr>
                <tr>
                    <td align="right">关键字</td>
                    <td>
                        <input type="text" name="kw" value="" size="80" class="inpMain">
                    </td>
                </tr>
                <tr>
                    <td align="right">摘要</td>
                    <td>
                        <input type="text" name="site_keywords" value="" size="80" class="inpMain">
                    </td>
                </tr>
                <tr>
                    <td align="right">作者</td>
                    <td>
                        <input type="text" name="author" value="<=$authorinfo.username/>" size="80" class="inpMain">
                    </td>
                </tr>
                <tr>
                    <td align="right">来源</td>
                    <td>
                        <input type="text" name="author" value="" size="80" class="inpMain">
                    </td>
                </tr>
                <tr>
                    <td align="right">所属栏目</td>
                    <td>
                        <select name="catid">
                        <loop $catlist.0 $k $v/>
                        <if isset($catlist[$v.info.id])/>
                            <optgroup label="<=$v.info.category_name/>"/>
                                <loop $catlist[$v.info.id] $sk $sv />
                                    <option name="<=$sv.info.id/>"><=$sv.info.category_name/></option>
                                </loop/>
                            <optgroup/>
                        <else/>
                            <option name="<=$v.info.id/>"><=$v.info.category_name/></option>
                        </if/>
                        </loop/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td align="right">文章模板</td>
                    <td>
                        <select name="tplid">
                            <loop $tpllist $k $v />
                            <option value="<=$v.id/>"<if $catinfo.tplid == $v.id/> selected</if/>><=$v.template_name/></option>
                            </loop/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td align="right">内容正文</td>
                    <td>
                        <div id="contentbox"></div>
                    </td>
                </tr>
                <tr>
                    <td align="right">附加内容</td>
                    <td>
                        <label for="none">
                            <input type="radio" name="datatype" id="none" value="0" checked /> 无
                        </label>
                        <label for="imagegroup">
                            <input type="radio" name="datatype" id="imagegroup" value="1" /> 套图
                        </label>
                        <label for="video">
                            <input type="radio" name="datatype" value="video" id="2" /> 视频
                        </label>
                    </td>
                </tr>
                <tr id="addonRow" class="hide">
                    <td align="right"></td>
                    <td>
                        <div id="addon"></div>
                        <div><button type="button" class="btn">上传</button></div>
                    </td>
                </tr>
                <tr>
                    <td align="right"></td>
                    <td>
                      <button type="submit" class="btnPayment">确定</button>
                    </td>
                </tr>
                 </tbody>
            </table>
            <div class="hide" id="popContainer">
                <div class="imageAdd">
                    <div class="row">
                        <label class="rowLabel">选择图片:</label>
                        <div class="rowEle upBtn">
                            <div class="virtualBtn"/>选择文件</div>
                            <input type="file" class="fileIpt" name="file" />
                        </div>
                    </div>
                    <div class="row">
                        <label class="rowLabel">描述文字:</label>
                        <div class="rowEle">
                            <input size="60" type="text" name="brief" value="" class="inpMain"/>
                        </div>
                    </div>
                </div>
            </div>
    </div>
</define/>

<define name="css"/>

<link rel="stylesheet" type="text/css" href="/wangeditor/css/wangEditor.min.css">
<style type="text/css">
    #contentbox{
        height:400px;
        width:100%;
    }
</style>

</define/>

<define name="js"/>
<script type="text/javascript" src="/wangeditor/js/wangEditor.min.js"></script>
<script type="text/javascript">

var pWin = window;

var editor = new wangEditor('contentbox');

    editor.create();

$(':radio[name=datatype]').on('click', function(){
    
    var dataType = $(this).val();

    $('#addonRow').addClass('hide');

    if(dataType == 0) return;

    $('#addonRow').removeClass('hide');
})

$('#addonRow button').on('click', function(){
    var upParams = {
        runtimes: 'html5,flash,html4',      // 上传模式,依次退化
        browse_button: 'uploadIpt',
        uptoken_url: '/admin/upload/token',
        get_new_uptoken: true,
        unique_names: true,
        domain: '',
        container: '',
        max_file_size: '100mb',
        flash_swf_url: '/flash/moxie.swf',
        max_retries: 3,
        dragdrop: true,
        drop_element: '',
        chunk_size: '1mb',
        auto_start: true,
        init:{
            FileUploaded: function(){

            },
            UploadComplete: function(){

            }
        }
    };

    var params = {
        onCreate: function(){

            $(':file', this).attr('id', 'uploadIpt');

            Qiniu.uploader(upParams);
        }
    };

    pWin.showConfirm($('#popContainer').html(), '添加图片', params);
})

</script>
</define/>