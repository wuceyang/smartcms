<extend from="admin/base.html"/>

<define name="content"/>
<div class="star-text">
  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px; margin-right: 120px;">
    <legend><=$type/></legend>
  </fieldset>
  <span class="star-tool">
  <a href="/admin/content/publish" class="layui-btn layui-btn-normal"><i class="layui-icon">&#xe642;</i> 资讯录入</a>
  </span>
  <table class="layui-table" lay-skin="line">
    <colgroup>
      <col width="50">
      <col width="120">
      <col width="60">
      <col width="300">
      <col width="200">
      <col>
    </colgroup>
    <thead>
      <tr>
        <th>ID</th>
        <th>发布日期</th>
        <th>是否热门</th>
        <th>标题</th>
        <th>操作</th>
      </tr> 
    </thead>
    <tbody>
      <loop $list $k $v/>
        <tr>
            <td><=$v.ID/></td>
            <td><=$v.CreateTime/></td>
            <td><=$v.IsRecommend == 2 ? 'Y' : '-'/></td>
            <td><=$v.Title/></td>
            <td>
                <a data-id="<=$v.ID/>" class="layui-btn layui-btn-warm layui-btn-small" href="/admin/content/edit?id=<=$v.ID/>"><i class="layui-icon">&#xe642;</i> 编辑</a>
                <button data-id="<=$v.ID/>" class="layui-btn layui-btn-danger layui-btn-small delbtn"><i class="layui-icon">&#xe640;</i> 删除</button>
            </td>
            </tr>
        </loop/>
        <if !$list/>
        <tr>
            <td colspan="5" align="center">当前暂无数据</td>
        </tr>
        </if/>
    </tbody>
  </table>
  <div class="star-page">
        <div class="layui-box layui-laypage layui-laypage-default star-left">
        <=$pageParam.pageStr/>
        </div>
        <div class="star-right star-total">共计<=$pageParam.totalRecord/>条，当前<=$pageParam.curPage/>/<=$pageParam.totalPage/>页</div>
        <div class="star-clear"></div>
  </div>
</div>
</define/>

<define name="css"/>
<link rel="stylesheet" href="<=__RESPATH__/>/theme/res/css/star.css"/>
</define/>

<define name="js"/>
<script type="text/javascript">
layui.use(['jquery', 'layer', 'upload', 'form'], function() {
    var $ = layui.jquery, layer = layui.layer, form = layui.form();

    $('.delbtn').on('click', function () {

        var advId = $(this).data('id');

        var popbox = layer.confirm('确定要删除当前资讯吗？', {icon: 3, title: '删除确认'}, function () {

            $.ajax({

                url: '/admin/content/remove?id=' + advId,

                dataType: 'json',

                success: function (ret) {

                    if (ret.code = 200) {

                        layer.close(popbox);

                        layer.msg("资讯删除成功", {icon: 6, title: '操作结果'}, function () {

                            top.location.reload();
                        });

                        return;
                    }

                    layer.alert(ret.message || '删除资讯出错啦', {icon: 5});
                },

                error: function () {

                    layer.alert('删除资讯出错啦', {icon: 5});
                }
            })
        });
    });

});
</script>
</define/>