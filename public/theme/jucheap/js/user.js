(function(){Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)i.hasOwnProperty(t)&&new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};String.prototype.getDate=function(){var n=/\d{13}/.exec(this),t=new Date(parseInt(n));return t.format("yyyy-MM-dd HH:mm:ss")}})();var XPage={DelData:function(n){var t=JucheapGrid.GetDataTableDeleteData();t.Len>0&&t.Data.length>0?parent.layer.confirm("确认要删除这"+t.Len+"条数据？",{btn:["确认","取消"]},function(){var i=$("#btnDel");i.button("loading");$.ajax({url:n,type:"POST",dataType:"json",data:JSON.stringify({ids:t.Data}),contentType:"application/json, charset=utf-8",success:function(n){i.button("reset");n.flag?(parent.layer.alert("删除成功"),$("#table_list").trigger("reloadGrid")):parent.layer.alert("删除失败："+n.msg)}})},function(){}):parent.layer.alert("请选择要删除的数据！")},GoTo:function(n,t){$(n).button("loading");window.location.href=t},Search:function(n){var t=$("#table_list").jqGrid("getGridParam","postData");$.extend(t,n);$("#table_list").setGridParam({search:!0}).trigger("reloadGrid",[{page:1}])},DoPost:function(n,t,i,r,u){var f=n!=null,e;f&&$(n).button("loading");e=$.ajax({url:t,type:"POST",data:i,dataType:"JSON",success:function(t){f&&$(n).button("reset");t.flag?r==null||typeof r=="undefined"?parent.layer.alert("操作成功"):r.call(this,t):u==null||typeof u=="undefined"?parent.layer.alert("操作失败："+t.msg):u.call(this,t)},complete:function(t,i){f&&$(n).button("reset");i==="timeout"&&(e.abort(),parent.layer.alert("请求超时，请刷新页面重试"));i==="error"&&(e.abort(),parent.layer.alert("请求失败，请刷新页面重试"))}})},AddCondition:function(){var t=$("#panel-condition"),n=$('<div class="row">'+t.find(".row:first").html()+"<\/div>");n.find(".date").removeClass("date");n.find(".input-group-addon").addClass("hidden");n.appendTo(t)},DelCondition:function(n){$("#panel-condition .row").length>1&&$(n).parent().parent().parent().parent().remove()},InitCondition:function(n){for(var f=$("#panel-condition .row select[name='FieldName']"),r=$("#"+n),e=r.jqGrid("getGridParam","colNames"),o=r.jqGrid("getGridParam","colModel"),u=[],i,t=0;i=o[t];t++)i.search&&u.push(['<option value="',i.name,'" data-type="',i.dataType,'">',e[t],"<\/option>"].join(""));f.html(u.join(""));$("#btnAddCondition").bind("click",this.AddCondition);$("#btnAdvanceSearch").bind("click",n,this.AdvanceSearch)},ChangeControler:function(n){var i=$(n).parent().parent(),t=i.find("input[name='FieldData']");$(n).find("option:selected").data("type")==="date"?(t.prev().removeClass("hidden"),t.parent().addClass("date"),i.find(".input-group.date").datepicker({format:"yyyy-mm-dd",todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,autoclose:!0})):(t.prev().addClass("hidden"),i.find(".input-group.date").datepicker("remove"),t.parent().removeClass("date"))},AdvanceSearch:function(n){var t={GroupOperator:$("#txtSearchGroupOperator").val(),Rules:[]};$.each($("#panel-condition .row"),function(){t.Rules.push({FieldName:$(this).find("select[name='FieldName']").val(),OperatorName:$(this).find("select[name='Operator']").val(),Data:$(this).find("input[name='FieldData']").val()})});var r={filters:JSON.stringify(t)},i=$("#"+n.data),u=i.jqGrid("getGridParam","postData");$.extend(u,r);i.setGridParam({search:!0}).trigger("reloadGrid",[{page:1}])}}